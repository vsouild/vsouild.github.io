<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="5mokCk2SPXiw6YIG9Mrc-y6E8ZKqdN5kakogn-vGlP0">
  <meta name="baidu-site-verification" content="code-WNIl6AzuqB">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" integrity="sha256-AbA177XfpSnFEvgpYu1jMygiLabzPCJCRIBtR5jGc0k=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"vsouild.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.13.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"width":220},"copycode":{"enable":true,"style":"default"},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":true,"nav":null},"stickytabs":false,"motion":{"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="函数 MySQL自带了一些内置函数用来实现数据库的高级功能，内置函数大致有以下几类：数学函数、日期时间函数、字符串函数、加密与解密函数、信息函数、聚合函数。">
<meta property="og:type" content="article">
<meta property="og:title" content="MySQL扩展知识">
<meta property="og:url" content="https://vsouild.github.io/mysql-extension/index.html">
<meta property="og:site_name" content="Lv.0">
<meta property="og:description" content="函数 MySQL自带了一些内置函数用来实现数据库的高级功能，内置函数大致有以下几类：数学函数、日期时间函数、字符串函数、加密与解密函数、信息函数、聚合函数。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://vsouild.github.io/mysql-extension/image-20210603012122814.png">
<meta property="og:image" content="https://vsouild.github.io/mysql-extension/image-20210605182039058.png">
<meta property="og:image" content="https://vsouild.github.io/mysql-extension/image-20210603043815467.png">
<meta property="og:image" content="https://vsouild.github.io/mysql-extension/image-20210605002419082.png">
<meta property="og:image" content="https://vsouild.github.io/mysql-extension/image-20210605003628334.png">
<meta property="og:image" content="https://vsouild.github.io/mysql-extension/image-20210605235130332.png">
<meta property="og:image" content="https://vsouild.github.io/mysql-extension/image-20210606001559927.png">
<meta property="og:image" content="https://vsouild.github.io/mysql-extension/image-20210612235935464.png">
<meta property="og:image" content="https://vsouild.github.io/mysql-extension/image-20210608155134256.png">
<meta property="og:image" content="https://vsouild.github.io/mysql-extension/image-20210609031455914.png">
<meta property="og:image" content="https://vsouild.github.io/mysql-extension/image-20210614184231206.png">
<meta property="og:image" content="https://vsouild.github.io/mysql-extension/image-20210615171804024.png">
<meta property="og:image" content="https://vsouild.github.io/mysql-extension/image-20210615173049685.png">
<meta property="article:published_time" content="2021-07-02T07:16:00.000Z">
<meta property="article:modified_time" content="2021-07-02T07:16:00.000Z">
<meta property="article:author" content="Vsouild">
<meta property="article:tag" content="mysql">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://vsouild.github.io/mysql-extension/image-20210603012122814.png">


<link rel="canonical" href="https://vsouild.github.io/mysql-extension/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://vsouild.github.io/mysql-extension/","path":"mysql-extension/","title":"MySQL扩展知识"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>MySQL扩展知识 | Lv.0</title>
  






  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Lv.0</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">talk is cheap, show me the code</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%87%BD%E6%95%B0"><span class="nav-text"> 函数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E5%AD%A6%E5%87%BD%E6%95%B0"><span class="nav-text"> 数学函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%97%A5%E6%9C%9F%E6%97%B6%E9%97%B4%E5%87%BD%E6%95%B0"><span class="nav-text"> 日期时间函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%87%BD%E6%95%B0"><span class="nav-text"> 字符串函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8A%A0%E5%AF%86%E4%B8%8E%E8%A7%A3%E5%AF%86%E5%87%BD%E6%95%B0"><span class="nav-text"> 加密与解密函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BF%A1%E6%81%AF%E5%87%BD%E6%95%B0"><span class="nav-text"> 信息函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%81%9A%E5%90%88%E5%87%BD%E6%95%B0"><span class="nav-text"> 聚合函数</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%85%B3%E4%BA%8Ecount"><span class="nav-text"> 关于COUNT(*)</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B6%E5%AE%83%E5%87%BD%E6%95%B0"><span class="nav-text"> 其它函数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%B4%A2%E5%BC%95"><span class="nav-text"> 索引</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%B4%A2%E5%BC%95%E7%9A%84%E7%B1%BB%E5%9E%8B"><span class="nav-text"> 索引的类型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%9A%E5%88%97%E7%B4%A2%E5%BC%95"><span class="nav-text"> 多列索引</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E7%B4%A2%E5%BC%95"><span class="nav-text"> 使用索引</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E7%B4%A2%E5%BC%95"><span class="nav-text"> 创建索引</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E4%B8%8E%E6%9F%A5%E8%AF%A2%E7%B4%A2%E5%BC%95"><span class="nav-text"> 删除与查询索引</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8B%E5%8A%A1"><span class="nav-text"> 事务</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#acid%E5%9B%9B%E5%A4%A7%E7%89%B9%E6%80%A7"><span class="nav-text"> ACID四大特性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%8B%E5%8A%A1%E8%AF%AD%E5%8F%A5"><span class="nav-text"> 事务语句</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%9A%90%E5%BC%8F%E6%8F%90%E4%BA%A4"><span class="nav-text"> 隐式提交</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AE%BF%E9%97%AE%E6%A8%A1%E5%BC%8F"><span class="nav-text"> 访问模式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BA%8B%E5%8A%A1%E5%B1%9E%E6%80%A7%E8%8C%83%E5%9B%B4"><span class="nav-text"> 事务属性范围</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E4%B8%80%E8%87%B4%E6%80%A7%E9%97%AE%E9%A2%98"><span class="nav-text"> 数据一致性问题</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%84%8F%E8%AF%BB"><span class="nav-text"> 脏读</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%8D%E5%8F%AF%E9%87%8D%E5%A4%8D%E8%AF%BB"><span class="nav-text"> 不可重复读</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B9%BB%E8%AF%BB"><span class="nav-text"> 幻读</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB"><span class="nav-text"> 隔离级别</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B4%A6%E6%88%B7%E4%B8%8E%E6%9D%83%E9%99%90%E7%B3%BB%E7%BB%9F"><span class="nav-text"> 账户与权限系统</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B4%A6%E6%88%B7%E7%B3%BB%E7%BB%9F"><span class="nav-text"> 账户系统</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%84%E7%95%99%E8%B4%A6%E6%88%B7"><span class="nav-text"> 预留账户</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0%E4%B8%8E%E5%88%A0%E9%99%A4%E8%B4%A6%E6%88%B7"><span class="nav-text"> 添加与删除账户</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9%E8%B4%A6%E6%88%B7%E4%BF%A1%E6%81%AF"><span class="nav-text"> 修改账户信息</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86"><span class="nav-text"> 权限管理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%86%E9%85%8D%E6%9D%83%E9%99%90"><span class="nav-text"> 分配权限</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%92%A4%E9%94%80%E6%9D%83%E9%99%90"><span class="nav-text"> 撤销权限</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E5%A4%87%E4%BB%BD%E4%B8%8E%E6%81%A2%E5%A4%8D"><span class="nav-text"> 数据库的备份与恢复</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%87%E4%BB%BD%E6%95%B0%E6%8D%AE"><span class="nav-text"> 备份数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%81%A2%E5%A4%8D%E6%95%B0%E6%8D%AE"><span class="nav-text"> 恢复数据</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Vsouild"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">Vsouild</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">21</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">25</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="http://wpa.qq.com/msgrd?v=3&uin=360301524&site=qq&menu=yes" title="QQ → http:&#x2F;&#x2F;wpa.qq.com&#x2F;msgrd?v&#x3D;3&amp;uin&#x3D;360301524&amp;site&#x3D;qq&amp;menu&#x3D;yes" rel="noopener" target="_blank"><i class="fab fa-qq fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://github.com/vsouild" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;vsouild" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:360301524@qq.com" title="E-Mail → mailto:360301524@qq.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i></a>
      </span>
  </div>
  <div class="cc-license site-overview-item animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://vsouild.github.io/mysql-extension/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Vsouild">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lv.0">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="MySQL扩展知识 | Lv.0">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          MySQL扩展知识
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-07-02 15:16:00" itemprop="dateCreated datePublished" datetime="2021-07-02T15:16:00+08:00">2021-07-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/mysql/" itemprop="url" rel="index"><span itemprop="name">mysql</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>13k</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h2 id="函数"><a class="markdownIt-Anchor" href="#函数"></a> 函数</h2>
<p>MySQL自带了一些内置函数用来实现数据库的高级功能，内置函数大致有以下几类：数学函数、日期时间函数、字符串函数、加密与解密函数、信息函数、聚合函数。</p>
<span id="more"></span>
<h3 id="数学函数"><a class="markdownIt-Anchor" href="#数学函数"></a> 数学函数</h3>
<table>
<thead>
<tr>
<th>函数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>ABS()</td>
<td>计算绝对值</td>
</tr>
<tr>
<td>PI()</td>
<td>圆周率，默认显示7位小数</td>
</tr>
<tr>
<td>POW()或POWER()</td>
<td>计算x的y次方</td>
</tr>
<tr>
<td>SQRT()</td>
<td>计算非负数的平方根</td>
</tr>
<tr>
<td>RAND()</td>
<td>获取一个[0,1)之间的随机数，可以指定一个整数作为种子</td>
</tr>
<tr>
<td>SIN()、COS()、TAN()、COT()</td>
<td>三角函数</td>
</tr>
<tr>
<td>ASIN()、ACOS()、ATAN()或ATAN2()</td>
<td>反三角函数</td>
</tr>
<tr>
<td>CEIL()或CEILING()</td>
<td>向下取整</td>
</tr>
<tr>
<td>FLOOR()</td>
<td>向上取整</td>
</tr>
<tr>
<td>ROUND()</td>
<td>四舍五入，可指定舍入的位数，默认为0，为负时向小数点前舍入，最大（小）值±30</td>
</tr>
<tr>
<td>CONV()</td>
<td>将N进制的值转换为M进制，进制取值范围为[2,36]</td>
</tr>
<tr>
<td>SIGN()</td>
<td>判断有理数的类型，正数为1，负数为-1，0则是0</td>
</tr>
<tr>
<td>EXP()、LN()</td>
<td>e（自然常数）的X次方，e为底X的对数</td>
</tr>
<tr>
<td>LOG(b,x)</td>
<td>计算x为底b的对数，省略x时相当于LN()</td>
</tr>
<tr>
<td>LOG2()、LOG10()</td>
<td>计算2为底x的对数，10为底x的对数</td>
</tr>
<tr>
<td>MOD()</td>
<td>模运算（取余），适用于小数</td>
</tr>
<tr>
<td>FORMAT()</td>
<td>以千位分隔符的方式显示数字，需指定小数位数（四舍五入处理）</td>
</tr>
<tr>
<td>HEX()</td>
<td>返回十进制数字或字符串的16进制表示</td>
</tr>
<tr>
<td>TRUNCATE()</td>
<td>将x截断d位小数，如果d为负则将前面d位整数置0</td>
</tr>
</tbody>
</table>
<p>一些示例：</p>
<p><img src="image-20210603012122814.png" alt="image-20210603012122814" /></p>
<h3 id="日期时间函数"><a class="markdownIt-Anchor" href="#日期时间函数"></a> 日期时间函数</h3>
<p>对于日期与时间函数，默认格式为<code>YYYY-MM-DD hh:mm:ss</code>，与数字进行计算时，返回<code>YYYYMMDDhhmmss</code>格式</p>
<table>
<thead>
<tr>
<th>函数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>CURDATE()或CURRENT_DATE()或CURRENT_DATE</td>
<td>返回当前日期</td>
</tr>
<tr>
<td>CURTIME()或CURRENT_TIME()或CURRENT_TIME</td>
<td>返回当前时间</td>
</tr>
<tr>
<td>NOW()或CURRENT_TIMESTAMP()或CURRENT_TIMESTAMP<br />或LOCALTIME()或LOCALTIME<br />或LOCALTIMESTAMP()或LOCALTIMESTAMP</td>
<td>返回当前日期和时间，这是常量时间，表示语句开始执行时的时间</td>
</tr>
<tr>
<td>UNIX_TIMESTAMP()</td>
<td>时间戳，表示自1970-01-01 00:00:00 UTC开始的秒数</td>
</tr>
<tr>
<td>ADDDATE(expr,days)</td>
<td>返回指定日期添加days天后的日期</td>
</tr>
<tr>
<td>ADDTIME(expr1,expr2)</td>
<td>返回expr1添加expr2后的结果，expr1为时间或日期时间表达式，expr2为时间表达式</td>
</tr>
<tr>
<td>MAKEDATE(year,dayofyear)</td>
<td>返回给定年份和天数的日期</td>
</tr>
<tr>
<td>QUARTER()</td>
<td>给定日期返回季度值（1到4）</td>
</tr>
<tr>
<td>SYSDATE()</td>
<td>与NOW()相似，但表示表达式具体执行时的时间</td>
</tr>
<tr>
<td>TIME_TO_SEC()</td>
<td>将时间值转换为秒数</td>
</tr>
<tr>
<td>TO_DAYS()</td>
<td>将日期转换为天数</td>
</tr>
<tr>
<td>TO_SECONDS()</td>
<td>将日期或日期时间转换为秒数</td>
</tr>
<tr>
<td>UTC_DATE或UTC_DATE()、UTC_TIME或UTC_TIME()、<br />UTC_TIMESTAMP或UTC_TIMESTAMP()</td>
<td>返回当前UTC日期、时间、日期和时间值</td>
</tr>
<tr>
<td>WEEKDAY()</td>
<td>返回指定日期是星期几（0到6表示星期一到星期日）</td>
</tr>
<tr>
<td>WEEKOFYEAR()</td>
<td>返回指定日期是第几周（范围1到53）</td>
</tr>
<tr>
<td>DAY()或DAYOFMONTH()</td>
<td>返回指定日期是当前月的第几天</td>
</tr>
<tr>
<td>DAYOFWEEK()</td>
<td>返回指定日期是星期几（1到7表示星期一到星期日）</td>
</tr>
<tr>
<td>DAYOFYEAR()</td>
<td>返回指定日期是当年的第几天</td>
</tr>
<tr>
<td>FROM_DAYS()</td>
<td>给定天数返回日期值</td>
</tr>
<tr>
<td>LAST_DAY()</td>
<td>返回指定日期当月最后一天的日期</td>
</tr>
</tbody>
</table>
<p>示例：</p>
<p><img src="image-20210605182039058.png" alt="image-20210605182039058" /></p>
<h3 id="字符串函数"><a class="markdownIt-Anchor" href="#字符串函数"></a> 字符串函数</h3>
<p>对于字符串函数，如果结果长度大于系统变量<code>max_allowed_packet</code>的值（默认4194304，4MB，最大1GB），则会返回NULL；字符串的第一个位置编号为1；需要长度参数的函数，传入非整数时会舍入到最接近的整数</p>
<table>
<thead>
<tr>
<th>函数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>ASCII()</td>
<td>返回字符串最左边字符的ASCII码</td>
</tr>
<tr>
<td>BIN()</td>
<td>返回10进制数的二进制字符串表示形式</td>
</tr>
<tr>
<td>OCT()</td>
<td>返回10进制数的八进制字符串表示形式</td>
</tr>
<tr>
<td>UNHEX()</td>
<td>返回16进制字符串的字符串表示</td>
</tr>
<tr>
<td>BIT_LENGTH()</td>
<td>以位为单位返回字符串的长度</td>
</tr>
<tr>
<td>CHAR_LENGTH()或CHARACTER_LENGTH()</td>
<td>以字符为单位返回字符串的长度</td>
</tr>
<tr>
<td>LENGTH()或OCTET_LENGTH()</td>
<td>以字节为单位返回字符串的长度</td>
</tr>
<tr>
<td>CONCAT()</td>
<td>将一个或多个参数连接为字符串</td>
</tr>
<tr>
<td>CONCAT_WS()</td>
<td>以第一个参数作为分隔符将一个或多个参数连接为字符串</td>
</tr>
<tr>
<td>TO_BASE64()</td>
<td>base64编码</td>
</tr>
<tr>
<td>FROM_BASE64()</td>
<td>base64解码</td>
</tr>
<tr>
<td>INSERT(str,pos,len,newstr)</td>
<td>插入字符串，将str的pos位置的len长度替换为newstr<br />如果pos超过范围，则不作处理，如果len超过范围则替换到末尾</td>
</tr>
<tr>
<td>REPLACE(str,old,new)</td>
<td>将字符串str中的old字符替换为new字符，区分大小写</td>
</tr>
<tr>
<td>INSTR(str,substr)或LOCATE(substr,str)或POSITION(substr IN str)</td>
<td>返回substr在sub第一次出现的位置，0表示不存在</td>
</tr>
<tr>
<td>LOWER()或LCASE()</td>
<td>将字符串转换为小写</td>
</tr>
<tr>
<td>UPPER()或UCASE()</td>
<td>将字符串转换为大写</td>
</tr>
<tr>
<td>LEFT(str,len)</td>
<td>返回str从最左边开始的len个字符</td>
</tr>
<tr>
<td>RIGHT(str,len)</td>
<td>返回str从最右边开始的len个字符</td>
</tr>
<tr>
<td>LTRIM()，RTRIM()，TRIM()</td>
<td>删除前导空白字符，删除尾随空白字符，删除两边的空白字符</td>
</tr>
<tr>
<td>SUBSTR(str,pos,len)或SUBSTRING(str,pos,len)或MID(str,pos,len)</td>
<td>返回str从pos位置开始的len个字符串，SUBSTR与SUBSTRING不带len参数时截取到末尾，如果len小于1则返回空字符串</td>
</tr>
<tr>
<td>QUOTE()</td>
<td>返回字符串的引用形式，保留转义符。多用于防止SQL注入</td>
</tr>
<tr>
<td>REPEAT(str,count)</td>
<td>返回str重复count次后的字符串</td>
</tr>
<tr>
<td>REVERSE()</td>
<td>反转字符串</td>
</tr>
<tr>
<td>SPACE(N)</td>
<td>返回N个由空格组成的字符串</td>
</tr>
</tbody>
</table>
<p>关于base64，MySQL使用的方案为：</p>
<ul>
<li>转换表中第62位为<code>+</code>，第63位为<code>/</code></li>
<li>编码输出由4组可打印的字符组成。如果最后一组的长度不足4，则用<code>=</code>填充</li>
<li>每76个字符添加一个换行符</li>
<li>解码时忽略换行符、回车符、制表符和空格</li>
</ul>
<p>字符串函数示例：</p>
<p><img src="image-20210603043815467.png" alt="image-20210603043815467" /></p>
<h3 id="加密与解密函数"><a class="markdownIt-Anchor" href="#加密与解密函数"></a> 加密与解密函数</h3>
<table>
<thead>
<tr>
<th>函数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>AES_DECRYPT()、AES_ENCRYPT()</td>
<td>AES解密、加密</td>
</tr>
<tr>
<td>MD5()</td>
<td>计算MD5校验和</td>
</tr>
<tr>
<td>RANDOM_BYTES()</td>
<td>指定字节长度通过SSL库的随机数生成器生成随机的二进制字符串，长度范围为1到1024</td>
</tr>
<tr>
<td>SHA1()或SHA()</td>
<td>计算的SHA-1的160位校验和</td>
</tr>
<tr>
<td>SHA2(str, length)</td>
<td>指定结果长度计算字符串的SHA-2哈希值，长度值必须为224、256、384、512或0（相当于256）之一</td>
</tr>
</tbody>
</table>
<p>示例：</p>
<p><img src="image-20210605002419082.png" alt="image-20210605002419082" /></p>
<h3 id="信息函数"><a class="markdownIt-Anchor" href="#信息函数"></a> 信息函数</h3>
<table>
<thead>
<tr>
<th>函数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>BENCHMARK(count,expr)</td>
<td>重复执行一个表达式，用于测试标量表达式的性能</td>
</tr>
<tr>
<td>CHARSET()</td>
<td>返回字符串的字符集</td>
</tr>
<tr>
<td>COLLATION()</td>
<td>返回字符串的排序规则</td>
</tr>
<tr>
<td>COERCIBILITY()</td>
<td>返回字符串的排序规则可压缩性值，值的范围0到5表示强度由高到低，用于确定在多个操作数时该使用谁的排序规则</td>
</tr>
<tr>
<td>CONNECTION_ID()</td>
<td>返回当前客户端链接的（线程）ID，这是唯一值</td>
</tr>
<tr>
<td>CURRENT_USER()或CURRENT_USER</td>
<td>当前经过身份验证的用户名和主机名</td>
</tr>
<tr>
<td>DATABASE()或SCHEMA()</td>
<td>返回当前（默认）使用的数据库名称</td>
</tr>
<tr>
<td>FOUND_ROWS()</td>
<td>在执行带有LIMIT子句的SELECT语句后使用，返回如果不使用LIMIT子句时查询到的总行数</td>
</tr>
<tr>
<td>LAST_INSERT_ID()</td>
<td>上次插入数据时，具有自动增量属性的列的值</td>
</tr>
<tr>
<td>ROW_COUNT()</td>
<td>受到更新影响的行数</td>
</tr>
<tr>
<td>USER()或SESSION_USER()或SYSTEM_USER()</td>
<td>客户端提供的用户名和主机名，与CURRENT_USER不一定相同</td>
</tr>
<tr>
<td>VERSION()</td>
<td>当前MySQL服务器的版本号</td>
</tr>
</tbody>
</table>
<p>示例：</p>
<p><img src="image-20210605003628334.png" alt="image-20210605003628334" /></p>
<h3 id="聚合函数"><a class="markdownIt-Anchor" href="#聚合函数"></a> 聚合函数</h3>
<p>聚合函数是对值的结果集进行操作，通常与<code>GROUP BY</code>子句一起使用，用于将值按条件分组到子集中。</p>
<table>
<thead>
<tr>
<th>函数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>AVG()</td>
<td>计算表达式（列）的平均值</td>
</tr>
<tr>
<td>BIT_AND()、BIT_OR()、BIT_XOR()</td>
<td>返回表达式（列）中所有值的按位与、或、异或。按64位精度计算</td>
</tr>
<tr>
<td>COUNT()</td>
<td>返回SELECT语句查询到行数</td>
</tr>
<tr>
<td>MAX()、MIN()</td>
<td>计算表达式（列）的最大值、最小值</td>
</tr>
<tr>
<td>SUM()</td>
<td>对表达式（列）求和</td>
</tr>
<tr>
<td>JSON_ARRAYAGG()、JSON_OBJECTAGG()</td>
<td>将结果集作为单个JSON数组、对象返回（需MySQL版本大于5.7.22）</td>
</tr>
</tbody>
</table>
<p>示例数据表与数据如下</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> `number` (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `number` () <span class="keyword">VALUES</span> (<span class="number">79</span>), (<span class="number">80</span>), (<span class="number">59</span>), (<span class="number">54</span>), (<span class="number">94</span>), (<span class="number">6</span>), (<span class="number">49</span>), (<span class="number">23</span>), (<span class="number">66</span>), (<span class="number">63</span>), (<span class="number">16</span>);</span><br></pre></td></tr></table></figure>
<p><img src="image-20210605235130332.png" alt="image-20210605235130332" /></p>
<h4 id="关于count"><a class="markdownIt-Anchor" href="#关于count"></a> 关于COUNT(*)</h4>
<blockquote>
<p><code>COUNT(*)</code>返回查询到的所有行数，并且忽略NULL值</p>
<p>对于InnoDB存储引擎，它不保留表中行的内部计数，因为并发事务可能同时检索到不同数量的行，所以<code>SELECT COUNT(*)</code>只对当前事务可见的行进行计数。并且InnoDB以相同方式处理<code>SELECT COUNT(*)</code>和<code>SELECT COUNT(1)</code>操作，两者没有性能差异。</p>
<p>对于MyISAM存储引擎，<code>COUNT(*)</code>是经过优化的，可以在没有WHERE子句的SELECT语句中快速检索一个表中的列；而<code>COUNT(1)</code>仅在表中第一列的属性为非空时与<code>COUNT(*)</code>相同</p>
</blockquote>
<h3 id="其它函数"><a class="markdownIt-Anchor" href="#其它函数"></a> 其它函数</h3>
<p>除上述函数外还有类型转换函数、压缩与解压函数、ip地址函数、<a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/fulltext-search.html">全文搜索函数</a>、<a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/xml-functions.html">XML函数</a>、<a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/json-functions.html">JSON函数</a>、<a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/spatial-analysis-functions.html">地理位置分析函数</a>等等。此处列举部分</p>
<table>
<thead>
<tr>
<th>函数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>CAST(expr AS type)或CONVERT(expr,type)</td>
<td>强制类型转换</td>
</tr>
<tr>
<td>CONVERT(expr USING charset)</td>
<td>将数据以指定字符集作转换</td>
</tr>
<tr>
<td>COMPRESS()</td>
<td>压缩字符串</td>
</tr>
<tr>
<td>UNCOMPRESS()</td>
<td>解压字符串，传入非压缩字符串时将会返回NULL</td>
</tr>
<tr>
<td>UNCOMPRESSED_LENGTH()</td>
<td>返回压缩字符串在被压缩之前的长度</td>
</tr>
<tr>
<td>VALIDATE_PASSWORD_STRENGTH()</td>
<td>验证密码明文的强度，返回值从0到100表示由弱到强（需插件支持，否则始终为0）</td>
</tr>
<tr>
<td>DEFAULT()</td>
<td>返回列的默认值，没有时会返回错误</td>
</tr>
<tr>
<td>INET_ATON()、INET6_ATON()</td>
<td>返回IPv4、IPv6地址的10进制数值</td>
</tr>
<tr>
<td>INET_NTOA()、INET6_NTOA()</td>
<td>将10进制数值转换为IPv4、IPv6地址</td>
</tr>
<tr>
<td>IS_IPV4()、IS_IPV6()</td>
<td>判断是否为IPv4、IPv6地址格式</td>
</tr>
<tr>
<td>SLEEP()</td>
<td>休眠(暂停)指定的秒数</td>
</tr>
<tr>
<td>UUID()</td>
<td>返回一个UUID字符串</td>
</tr>
<tr>
<td>UUID_SHORT()</td>
<td>返回一个无符号64位的UUID整数</td>
</tr>
</tbody>
</table>
<p>示例：</p>
<p><img src="image-20210606001559927.png" alt="image-20210606001559927" /></p>
<h2 id="索引"><a class="markdownIt-Anchor" href="#索引"></a> 索引</h2>
<blockquote>
<p>索引是用于在表中快速查找具有特定列值的行记录的一种数据结构。如果不使用索引，MySQL则需要从第一行开始逐渐扫描到整个表以找到符合条件的记录，表越大越耗时。在表中设置索引后，MySQL可以快速定位到相关位置，而不必遍历所有数据。相当于字典中的按拼音、笔画检索</p>
</blockquote>
<p>实际上，索引也是一种表，它将主键或索引字段以及指向每个记录的指针保存到另外的表中。用户无需关心索引，它们只用来加快查询速度。使用了索引的表在插入和更新操作上会花费更多的时间，但查询会非常快。因为在插入或更新时，数据库也需要插入或更新相应的索引数据</p>
<h3 id="索引的类型"><a class="markdownIt-Anchor" href="#索引的类型"></a> 索引的类型</h3>
<p>索引按用途可以分为以下类型：</p>
<ul>
<li>普通索引（index）：基本索引，没有任何限制（可以重复，允许空值）</li>
<li>主键（primary key）索引：即创建主键时隐含的索引，是表的唯一标识，不允许重复，不允许空值，每个表只能有一个主键索引。作为最常见的索引，通常定义为自增属性的整数类型。InnoDB要求每个表都有一个这样的索引。<strong>不要使用任何与业务相关的字段作为主键</strong></li>
<li>唯一（unique）索引：顾名思义，值唯一的索引，不允许重复但可以为空值</li>
<li>全文（fulltext）索引：全文索引用于全文搜索，允许重复和空值，只能在CHAR、VARCHAR或TEXT类型的列上创建，且只有InnoDB和MyISAM存储引擎支持</li>
</ul>
<p>以及用于空间数据类型的空间（spatial）索引。额外的，ARCHIVE引擎不支持空间索引</p>
<hr />
<p>按存储方式（算法）可以分为：<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/B%E6%A0%91">B树</a>索引、<a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/glossary.html#glos_hash_index">哈希索引</a>、<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/R%E6%A0%91">R树</a>索引（用于空间数据类型）、<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/T-tree">T树</a></p>
<blockquote>
<p>MySQL的大多数索引（主键、唯一、全文和普通索引）使用B树结构存储。InnoDB中全文索引使用<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E5%80%92%E6%8E%92%E7%B4%A2%E5%BC%95">倒排列表</a><br />
内存存储引擎默认为哈希索引，同时支持B树索引<br />
NDB存储引擎中B树被实现为T树</p>
</blockquote>
<p>关于InnoDB无主键时的运行原理，引申阅读：<a target="_blank" rel="noopener" href="https://medium.com/@genchilu/a-brief-introduction-to-cluster-index-and-secondary-index-in-innodb-9b8874d4da6a">InnoDB中的聚簇索引和二级索引</a>以及<a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/innodb-index-types.html">MySQL手册14.6.2.1 Clustered and Secondary Indexes</a></p>
<h3 id="多列索引"><a class="markdownIt-Anchor" href="#多列索引"></a> 多列索引</h3>
<p>也叫复合索引，即除了对单列字段定义索引外，还可以将多个列组合创建一个多列索引，InnoDB引擎最多允许16个列，只有查询条件中使用了这些列中第一个列时，多列索引才会被使用。多列索引可以被视为排序数组</p>
<blockquote>
<p>MySQL可以对多列索引中包含的所有列的查询进行索引，或者只索引第一列、前两列或者前三列，但不能对第二列或之后的列查询使用索引，所以多列索引第一列的选择很重要</p>
</blockquote>
<h3 id="使用索引"><a class="markdownIt-Anchor" href="#使用索引"></a> 使用索引</h3>
<h4 id="创建索引"><a class="markdownIt-Anchor" href="#创建索引"></a> 创建索引</h4>
<p>有三种方式创建索引，一是在创建表时指定索引，例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `article` (</span><br><span class="line">	`id` INT(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">	`title` VARCHAR(50) NOT NULL,</span><br><span class="line">	`slug` VARCHAR(50) NULL DEFAULT NULL COLLATE,</span><br><span class="line">	`text` TEXT NULL DEFAULT NULL COLLATE,</span><br><span class="line">	PRIMARY KEY (`id`), UNIQUE INDEX `slug` (`slug`), INDEX `id` (`id`, `title`, `slug`), FULLTEXT INDEX `text` (`text`)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>索引需要命名，在MySQL中，主键的名称是<code>PRIMARY</code>。对于其他索引，如果不指定名称，则会为索引指定与索引中第一列相同的名称，并使用带序号的后缀（_2, _3, _4, …）使其唯一</p>
<p>对于字符串类型的索引，可以指定仅使用列值前面部分长度的字节作为索引：<code>列名(长度)</code>。对于<code>TEXT</code>和<code>BLOB</code>类型则必须指定长度。为索引限制列的长度可以使索引文件更小，这可以节省大量的磁盘空间，还可以加快插入操作的速度。全文索引不支持列长度限制，因为索引总是在整个列的内容上进行操作</p>
</blockquote>
<p>二是使用<code>CREATE INDEX</code>创建索引，但是不能创建主键索引，不加修饰时为普通索引</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> [<span class="keyword">UNIQUE</span> <span class="operator">|</span> FULLTEXT <span class="operator">|</span> SPATIAL] INDEX 索引名 <span class="keyword">ON</span> 表名 (列) [注释]</span><br></pre></td></tr></table></figure>
<p><code>CREATE INDEX</code>等同于<code>ALTER TABLE</code>中添加索引，这便是第三种方式</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名 <span class="keyword">ADD</span> 索引类型 (列) [注释]</span><br></pre></td></tr></table></figure>
<p>索引类型中<code>KEY</code>与<code>INDEX</code>是同义词，但主键只能用<code>PRIMARY KEY</code>，唯一索引和全文索引可省略<code>KEY</code>或<code>INDEX</code></p>
<h4 id="删除与查询索引"><a class="markdownIt-Anchor" href="#删除与查询索引"></a> 删除与查询索引</h4>
<p>使用<code>DROP INDEX</code>删除索引，等同于<code>ALTER TABLE</code>中删除索引</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> INDEX 索引名 <span class="keyword">ON</span> 表名</span><br></pre></td></tr></table></figure>
<p>使用<code>DROP INDEX</code>删除主键，则索引名为<code>PRIMARY</code>且必须加反引号，如果主键含有自增属性，则无法直接删除</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名 <span class="keyword">DROP</span> [INDEX <span class="operator">|</span> KEY] 索引名</span><br><span class="line">或</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名 <span class="keyword">DROP</span> <span class="keyword">PRIMARY</span> KEY</span><br></pre></td></tr></table></figure>
<p>也可以重命名索引名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名 RENAME INDEX 旧索引名 <span class="keyword">TO</span> 新索引名</span><br></pre></td></tr></table></figure>
<p>MySQL中并没有提供直接修改索引其它属性的语句，变通的方法是删除原来的索引再添加</p>
<p>要查询索引信息，可以使用<code>SHOW INDEX</code>语句，其中<code>FROM 表名 FROM 库名</code>与<code>FROM 库名.表名</code>是等价的</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> &#123;INDEX <span class="operator">|</span> INDEXES <span class="operator">|</span> KEYS&#125; &#123;<span class="keyword">FROM</span> <span class="operator">|</span> <span class="keyword">IN</span>&#125; 表名或库名 [<span class="keyword">WHERE</span> 条件]</span><br></pre></td></tr></table></figure>
<p><img src="image-20210612235935464.png" alt="image-20210612235935464" /></p>
<p>其中一些属性释义：</p>
<ul>
<li>Non_unique：如果该索引不能包含重复项，则为0，否则为1</li>
<li>Seq_in_index：索引中列的序号，从1开始</li>
<li>Collation：列在索引中的排序方式。A表示升序，NULL表示未排序</li>
<li>Cardinality：对索引中唯一值的数量的估计值。该值是基于存储为整数的统计信息来计算的，因此即使对于小的表也不一定精确。此数越大，MySQL在执行连接时使用索引的可能性就越高</li>
<li>Sub_part：索引的前缀。如果列仅部分被索引，则为索引的字符长度；如果整列被索引，则为NULL</li>
<li>Packed：指示关键字的压缩方式，若没有则为NULL</li>
<li>Null：如果索引列是否包含NULL值，有则为YES；无则为空字符串</li>
<li>Index_type：索引使用的存储算法类型，BTREE、FULLTEXT、HASH或RTREE</li>
</ul>
<h2 id="事务"><a class="markdownIt-Anchor" href="#事务"></a> 事务</h2>
<p>事务（transaction）指的是在数据库管理系统中执行过程的一个逻辑单位，由一组有限的数据库操作序列构成。具体来说就是将多个增删改查语句作为一个可提交（commit）或回滚（rollback）的单个工作单元来执行，其只会产生两种结果：要么事务提交后所有操作都成功执行，要么事务回滚所有操作都不会执行</p>
<h3 id="acid四大特性"><a class="markdownIt-Anchor" href="#acid四大特性"></a> ACID四大特性</h3>
<p>在操作数据库写入或更新数据的过程中，为保证事务是正确可靠的，必须具备四个特性：</p>
<ul>
<li>原子性（Atomicity）：事务作为一个整体，被执行时其中对数据库的操作要么全部被执行，要么都不执行</li>
<li>一致性（Consistency）：在事务开始前和事务结束后，数据库的整体数据是完整的。</li>
<li>隔离性（Isolation）：多个事务并发执行时，一个事务的执行不应影响其他事务的执行</li>
<li>持久性（Durability）：成功执行的事务对数据库的修改应该被持久化存储，即使系统断电也不会丢失</li>
</ul>
<h3 id="事务语句"><a class="markdownIt-Anchor" href="#事务语句"></a> 事务语句</h3>
<p>MySQL通过<code>SET autocommit</code>、<code>START TRANSACTION</code>、<code>COMMIT</code>和<code>ROLLBACK</code>等语句来支持本地事务（区别于分布式）。默认情况下，MySQL的自动提交模式处于开启状态，即每一条语句都是原子的，不能使用回滚来撤消，但是如果语句的执行产生错误，则会回滚该语句。</p>
<p><img src="image-20210608155134256.png" alt="image-20210608155134256" /></p>
<ul>
<li><code>START TRANSACTION</code>或<code>BEGIN</code>开启一个新的事务，并且隐式禁用自动提交模式（提交或回滚后恢复）</li>
<li><code>SET autocommit=0</code>或<code>1</code>显式禁用或启用当前会话的自动提交模式。autocommit是会话变量，修改仅保留于会话中</li>
<li><code>COMMIT</code>提交当前事务，使其更改永久化</li>
<li><code>ROLLBACK</code>回滚当前事务，取消其所有更改</li>
<li><code>SET TRANSACTION</code>设定事务属性，如<a href="#%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB">隔离级别</a>（ISOLATION LEVEL）、访问模式</li>
</ul>
<h4 id="隐式提交"><a class="markdownIt-Anchor" href="#隐式提交"></a> 隐式提交</h4>
<p>在MySQL中，一些语句（及其任何同义词）如果在事务中执行，那么在执行前或执行后都会隐式地提交并结束当前会话中活动的任何事务，如定义或修改数据库对象的DDL语句，事务控制和锁定语句，数据加载语句，数据库管理语句，复制语句</p>
<p>同时因为隐式提交，所以存在这些语句的事务在执行后也无法回滚。在设计事务时不应包含此类语句</p>
<h4 id="访问模式"><a class="markdownIt-Anchor" href="#访问模式"></a> 访问模式</h4>
<p>访问模式决定在事务中对数据的操作是可读写（<code>READ WRITE</code>）还是只读（<code>READ ONLY</code>）</p>
<h4 id="事务属性范围"><a class="markdownIt-Anchor" href="#事务属性范围"></a> 事务属性范围</h4>
<p>可以在<code>SET</code>后跟<code>GLOBAL</code>或<code>SESSION</code>关键字来为全局或当前会话设置事务属性，根据范围的不同会产生不同的效果：</p>
<ul>
<li>全局：适用于所有后续会话；当前会话不受影响</li>
<li>会话：适用于当前会话中所有后续事务；可以在事务中设置但不影响当前事务</li>
<li>无关键字：仅适用于当前会话的下一个事务；事务中不允许使用（无关键字的设置）</li>
</ul>
<h3 id="数据一致性问题"><a class="markdownIt-Anchor" href="#数据一致性问题"></a> 数据一致性问题</h3>
<p>在一个以上的事务并发执行时，读取数据可能会出现三种问题：脏读（Dirty Read）、不可重复读（Non Repeatable Read）和幻读（Phantom Read）</p>
<h4 id="脏读"><a class="markdownIt-Anchor" href="#脏读"></a> 脏读</h4>
<p>脏读即一个事务会读到另一个事务<u>未提交</u>的（脏）数据</p>
<table>
<thead>
<tr>
<th>时刻</th>
<th>事务1</th>
<th>事务2</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>事务开始</td>
<td>事务开始</td>
</tr>
<tr>
<td>2</td>
<td></td>
<td>查询数据</td>
</tr>
<tr>
<td>3</td>
<td>更新数据</td>
<td></td>
</tr>
<tr>
<td>4</td>
<td></td>
<td>查询数据（<strong>脏读</strong>）</td>
</tr>
<tr>
<td>5</td>
<td>回滚</td>
<td></td>
</tr>
</tbody>
</table>
<p>如上所示，在事务2的时刻4时，读到了事务1更新后但未提交的数据，在事务1回滚后事务2读到的数据就是脏数据</p>
<h4 id="不可重复读"><a class="markdownIt-Anchor" href="#不可重复读"></a> 不可重复读</h4>
<p>区别于脏读，一个事务中连续两次读取的数据<u>内容不一致</u></p>
<table>
<thead>
<tr>
<th>时刻</th>
<th>事务1</th>
<th>事务2</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>事务开始</td>
<td>事务开始</td>
</tr>
<tr>
<td>2</td>
<td></td>
<td>查询数据</td>
</tr>
<tr>
<td>3</td>
<td>更新数据</td>
<td></td>
</tr>
<tr>
<td>4</td>
<td>提交</td>
<td></td>
</tr>
<tr>
<td>5</td>
<td></td>
<td>查询数据（<strong>不可重复读</strong>）</td>
</tr>
</tbody>
</table>
<p>在事务2读取到事务1更新前的数据但事务1没有回滚而是提交了，之后事务2再次读取到不同的数据，此时的现象便是不可重复读</p>
<h4 id="幻读"><a class="markdownIt-Anchor" href="#幻读"></a> 幻读</h4>
<p>幻读与不可重复读相似，区别在于<u>数量不一致</u></p>
<table>
<thead>
<tr>
<th>时刻</th>
<th>事务1</th>
<th>事务2</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>事务开始</td>
<td>事务开始</td>
</tr>
<tr>
<td>2</td>
<td></td>
<td>查询数据</td>
</tr>
<tr>
<td>3</td>
<td>插入/删除数据</td>
<td></td>
</tr>
<tr>
<td>4</td>
<td>提交</td>
<td></td>
</tr>
<tr>
<td>5</td>
<td></td>
<td>查询数据（<strong>幻读</strong>）</td>
</tr>
</tbody>
</table>
<p>如果事务2第一次查询数据时有x条数据，事务2插入或者删除n条数据并提交了，事务2再次查询发现有x±n条数据，如幻影一般，便是幻读</p>
<h3 id="隔离级别"><a class="markdownIt-Anchor" href="#隔离级别"></a> 隔离级别</h3>
<p>SQL标准（ISO/IEC 9075）为解决上述一致性问题定义了下列4种事务隔离级别，分别对应了是否存在数据一致性的问题：</p>
<table>
<thead>
<tr>
<th>隔离级别</th>
<th>脏读</th>
<th>不可重复读</th>
<th>幻读</th>
</tr>
</thead>
<tbody>
<tr>
<td>读未提交（Read Uncommitted）</td>
<td>有</td>
<td>有</td>
<td>有</td>
</tr>
<tr>
<td>读已提交（Read Committed）</td>
<td>无</td>
<td>有</td>
<td>有</td>
</tr>
<tr>
<td>可重复读（Repeatable Read）</td>
<td>无</td>
<td>无</td>
<td>有</td>
</tr>
<tr>
<td>可序列化（Serializable）</td>
<td>无</td>
<td>无</td>
<td>无</td>
</tr>
</tbody>
</table>
<p>从上到下隔离级别由低到高，隔离级别越高，隔离性也就越高，同时性能影响越大，可支持的并发也就越低</p>
<ul>
<li>读未提交是最低的隔离级别，在同一事务中可以读取其它事务未提交的数据，查询语句会以非锁定的方式执行，存在所有问题</li>
<li>读已提交只允许同一事务读取其它事务已经提交的数据，可以解决脏读但存在不可重复读的问题</li>
<li>可重复读会对同一事务的第一次读取建立快照，以保证同一事务中多个查询的一致性，解决了不可重复读的问题</li>
<li>可序列化作为最高的隔离级别，强制要求所有事务按次序执行，解决了问题，但是并发性能很低，所以很少使用</li>
</ul>
<blockquote>
<p>MySQL的InnoDB引擎默认隔离级别是<code>REPEATABLE READ</code>，默认访问模式为可读写<br />
<img src="image-20210609031455914.png" alt="image-20210609031455914" /></p>
</blockquote>
<p>可重复读依旧存在幻读的问题，可序列化性能又较低。为了解决幻读，InnoDB使用了各种各样的锁机制，此处就不再详解了，参考<a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/innodb-next-key-locking.html">MySQL手册14.7.4幻行</a></p>
<h2 id="账户与权限系统"><a class="markdownIt-Anchor" href="#账户与权限系统"></a> 账户与权限系统</h2>
<p>MySQL的账户系统可以使客户端用户连接到服务器并访问服务器管理的数据，权限系统则是对从给定主机连接的用户进行身份验证，并将该用户与数据库上的操作（如增删改查等）权限进行控制。权限系统确保所有用户只能执行被允许的操作。</p>
<blockquote>
<p>权限系统的不足之处：</p>
<ul>
<li>不能明确的拒绝指定用户的访问（可以锁定）</li>
<li>不能指定一个用户有创建或删除数据库中表的权限，但却没有创建或删除数据库本身的权限</li>
<li>用户密码适用于整个账户。不能将密码与特定的对象（如数据库、表或存储过程）相关联</li>
</ul>
</blockquote>
<p>MySQL中与用户权限有关的表都在数据库<code>mysql</code>中，共有6个：</p>
<ul>
<li><code>user</code>：用户帐户、全局权限和其他非权限字段</li>
<li><code>db</code>：数据库级别的权限。适用于库及库中的所有对象</li>
<li><code>tables_priv</code>：表级别的权限。其中授予的权限适用于表及其所有列</li>
<li><code>columns_priv:</code>：列级别的权限。仅适用于特定列</li>
<li><code>procs_priv</code>：存储过程和函数权限</li>
<li><code>proxies_priv</code>：代理用户权限。表示哪些用户可以作为其他用户的代理，以及用户是否可以将代理权限授予其他用户</li>
</ul>
<h3 id="账户系统"><a class="markdownIt-Anchor" href="#账户系统"></a> 账户系统</h3>
<p>账户身份由用户名和连接的主机名组成，在识别时会同时考虑主机名和用户名，因为同一个用户名可以在不同的主机上登录，并且可以授予相同用户名在不同主机上不同的权限。作为MySQL自身的账户系统，与操作系统的用户无关。</p>
<p>账户身份语法为<code>'用户名'@'主机名'</code>，@和主机名可以忽略，此时相当于<code>'用户名'@'%'</code>。用户名和主机名作为标识符或字符串使用时需要加上反引号、单引号或双引号（除了@符号）。如果用户名和主机名在未加引号前是合法的标识符，则无需引号。如果用户名中有特殊字符（如空格或-），或者主机名包含特殊字符或通配符（如.或%），则必须使用引号。</p>
<p><img src="image-20210614184231206.png" alt="image-20210614184231206" /></p>
<p>user表中中<code>user</code>和<code>host</code>即为用户名和主机名；带<code>priv</code>后缀的表示<code>Privilege</code>，即<a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/privileges-provided.html">权限信息</a>；<code>max</code>前缀的表示资源控制；其它的为访问控制</p>
<p>用户名最长32个字符，主机名最长60个字符，密码使用了特定的算法进行加密，默认情况下用户名和密码仅支持ASCII字符。在访问控制中进行比较时，用户名区分大小写，而主机名不区分。主机名部分可以使用多种形式：</p>
<ul>
<li>可以是域名或IP地址（IPv4或IPv6）。<code>localhost</code>表示本地主机，<code>127.0.0.1</code>表示IPv4环回接口，<code>::1</code>表示IPv6环回接口</li>
<li>允许使用通配符%和_匹配域名或IP地址，与模式匹配的LIKE含义相同。<br />
但<strong>IP通配符只匹配IP地址，不匹配域名</strong>，并且<strong>不支持在用户名中使用通配符</strong></li>
<li>IPv4地址可以使用掩码表示，如198.168.100.0/255.255.255.0</li>
</ul>
<p>使用<code>SHOW CREATE USER</code>语句查看当前账户创建语句</p>
<p><img src="image-20210615171804024.png" alt="image-20210615171804024" /></p>
<h4 id="预留账户"><a class="markdownIt-Anchor" href="#预留账户"></a> 预留账户</h4>
<p>在MySQL初始化后，会生成三个预留账户</p>
<ul>
<li>‘root’@‘localhost’：用于管理使用，具有所有权限，可以执行任何操作</li>
<li>‘mysql.sys’@‘localhost’：用于sys模式对象的定义器。此帐户可避免重命名或删除root帐户时出现问题。此帐户默认被锁定，无法用于客户端登录</li>
<li>‘mysql.session’@‘localhost’：由插件内部访问服务器使用。此帐户默认被锁定，无法用于客户端登录</li>
</ul>
<h4 id="添加与删除账户"><a class="markdownIt-Anchor" href="#添加与删除账户"></a> 添加与删除账户</h4>
<p>使用<code>CREATE USER</code>语句创建账户</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> [IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span>] 账户名 [IDENTIFIED <span class="keyword">BY</span> 密码] [<span class="keyword">WITH</span> 资源选项] [密码选项 <span class="operator">|</span> 锁定选项]</span><br></pre></td></tr></table></figure>
<p>创建后的账户没有权限，如果省略主机名则为<code>%</code>，密码使用明文即可。密码选项与锁定选项如下</p>
<ul>
<li><code>PASSWORD EXPIRE</code>：将密码标记为已过期</li>
<li><code>PASSWORD EXPIRE DEFAULT</code>：将密码标记为系统变量<code>default_password_lifetime</code>值的天数后过期，默认为0</li>
<li><code>PASSWORD EXPIRE NEVER</code>：将密码标记为永不过期</li>
<li><code>PASSWORD EXPIRE INTERVAL N DAY</code>：将密码标记为N天后过期</li>
<li><code>ACCOUNT LOCK</code>、<code>ACCOUNT UNLOCK</code>：标记账户为锁定状态或非锁定状态</li>
</ul>
<hr />
<p>使用<code>DROP USER</code>语句删除账户</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">USER</span> [IF <span class="keyword">EXISTS</span>] 账户名</span><br></pre></td></tr></table></figure>
<p>该语句可以删除一个或多个账户（包括其所有权限）；使用<code>IF EXISTS</code>来避免删除不存在的账户而报错；<code>DROP USER</code>不会自动删除或使被删除用户创建的数据库及其中的对象无效</p>
<blockquote>
<p>删除账户的操作被设计为不会自动关闭任何开启的用户会话，如果已登录的用户被删除，则在该用户关闭会话前删除不会生效</p>
</blockquote>
<h4 id="修改账户信息"><a class="markdownIt-Anchor" href="#修改账户信息"></a> 修改账户信息</h4>
<p>修改账户信息（包括密码）可以使用<code>ALTER USER</code>语句，语法与创建账户基本一致。第二种语法用于修改当前账户的密码</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">USER</span> [IF  <span class="keyword">EXISTS</span>] 账户名 [IDENTIFIED <span class="keyword">BY</span> 密码] [<span class="keyword">WITH</span> 资源选项] [密码选项 <span class="operator">|</span> 锁定选项]</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">USER</span> <span class="keyword">USER</span>() IDENTIFIED <span class="keyword">BY</span> 密码</span><br></pre></td></tr></table></figure>
<p>也可以使用<code>SET PASSWORD</code>语句来修改密码，不使用FOR时修改当前用户密码，密码使用明文即可</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> PASSWORD [<span class="keyword">FOR</span> 账户名] <span class="operator">=</span> 新密码</span><br></pre></td></tr></table></figure>
<p>要修改账户名，需要使用<code>RENAME USER</code>语句，重命名操作不会影响原有账户的所有权限</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RENAME <span class="keyword">USER</span> 旧账户名 <span class="keyword">TO</span> 新账户名</span><br></pre></td></tr></table></figure>
<h3 id="权限管理"><a class="markdownIt-Anchor" href="#权限管理"></a> 权限管理</h3>
<p>权限分为管理员权限和数据库权限</p>
<ul>
<li>管理员权限允许用户管理MySQL服务器，这些权限是全局的，并不特定于数据库</li>
<li>数据库权限应用于数据库及其内的所有对象。可以为特定的数据库授予，也可以全局授予</li>
</ul>
<p>可以分别为数据库中的特定对象或者特定类型的所有对象（如表、索引、视图和存储过程）全局授予权限。如果在连接时当前用户的权限被（自己或其他人）更改，则这些更改不一定对之后的语句生效</p>
<blockquote>
<p>不建议使用增删改语句直接操作权限表，由于这些修改而导致格式错误的数据会被服务器忽略，并且在手动重新加载权限表或重启MySQL之前，这些更改不会生效。MySQL 5.7.18之后，对于任何修改权限表的操作，服务器都会检查该表是否符合预期的格式，否则会报错</p>
</blockquote>
<p><code>SHOW GRANTS</code>以<code>GRANT</code>语句的形式显示分配给用户的权限</p>
<p><img src="image-20210615173049685.png" alt="image-20210615173049685" /></p>
<h4 id="分配权限"><a class="markdownIt-Anchor" href="#分配权限"></a> 分配权限</h4>
<p><code>GRANT</code>语句向用户授予权限</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GRANT</span> 权限类型 [(列名)] <span class="keyword">ON</span> 权限级别 <span class="keyword">TO</span> 账户名 [<span class="keyword">WITH</span> &#123;<span class="keyword">GRANT</span> OPTION <span class="operator">|</span> 资源选项&#125;]</span><br></pre></td></tr></table></figure>
<p>权限类型通常使用<code>ALL</code>表示<code>PRIVILEGES</code>，即所有权限，但不包括<code>GRANT OPTION</code>和<code>PROXY</code>权限（分配权限的权限与代理用户的权限），<code>USAGE</code>表示无任何权限。可后跟括号将列名括起来表示列级权限，多个列之间使用逗号分割。权限级别描述符有：</p>
<ul>
<li><code>*.*</code>全局权限</li>
<li><code>数据库名.*</code>指定数据库级权限，仅使用<code>*</code>时为当前默认数据库</li>
<li><code>数据库名.表名</code>指定表级权限，如果仅使用表名则表示默认数据库中的表</li>
</ul>
<p>授予所有权限：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GRANT</span> <span class="keyword">ALL</span> <span class="keyword">ON</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">TO</span> 账户名 <span class="keyword">WITH</span> <span class="keyword">GRANT</span> OPTION</span><br></pre></td></tr></table></figure>
<p>不增加<code>WITH GRANT OPTION</code>时，权限仅次于root</p>
<h4 id="撤销权限"><a class="markdownIt-Anchor" href="#撤销权限"></a> 撤销权限</h4>
<p><code>REVOKE</code>语句用于系统管理员撤销其它帐户的权限</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">REVOKE</span> 权限类型 [(列名)] <span class="keyword">ON</span> 权限级别 <span class="keyword">FROM</span> 账户名</span><br><span class="line"><span class="keyword">REVOKE</span> <span class="keyword">ALL</span> [PRIVILEGES], <span class="keyword">GRANT</span> OPTION <span class="keyword">FROM</span> 账户名</span><br><span class="line"><span class="keyword">REVOKE</span> PROXY <span class="keyword">ON</span> <span class="keyword">user</span> <span class="keyword">FROM</span> 账户名</span><br></pre></td></tr></table></figure>
<p>权限类型与级别同<code>GRANT</code>语句中描述的一样。要撤销其权限的用户帐户必须存在，但在撤销权限前不需要先授予。使用第二种语法撤销所有权限，但不会删除账户</p>
<ul>
<li>全局权限的更改仅在客户端下次会话连接时生效，更改不会应用于所有当前连接的用户</li>
<li>数据库级权限的更改在切换默认数据库之后生效</li>
<li>表和列权限的更改将在之后发出的查询操作生效</li>
</ul>
<blockquote>
<p><strong>当数据库或表被删除时，相应的权限不会被自动撤销</strong></p>
</blockquote>
<h2 id="数据库的备份与恢复"><a class="markdownIt-Anchor" href="#数据库的备份与恢复"></a> 数据库的备份与恢复</h2>
<p>MySQL作为保存数据的系统，为了在诸如系统宕机、硬件故障、用户误操作时不至于丢失数据，或升级MySQL时转移数据，其备份与恢复功能都是十分重要的。</p>
<p><strong>以下所有操作均需登录数据库</strong></p>
<h3 id="备份数据"><a class="markdownIt-Anchor" href="#备份数据"></a> 备份数据</h3>
<p>同客户端程序mysqld一样，MySQL提供了一个mysqldump程序用于逻辑备份，其主要生成一组SQL语句来转储数据库，此程序还可以生成CSV、其他分隔符格式或XML格式的文本。mysqldump程序的命令格式如下，每行表示一种语法</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysqldump [选项] 数据库名 [表名] [&gt; sql文件]</span><br><span class="line">mysqldump [选项] --databases 数据库名 [&gt; sql文件]</span><br><span class="line">mysqldump [选项] --all-databases [&gt; sql文件]</span><br></pre></td></tr></table></figure>
<p>多个选项、表名、数据库名之间使用空格分隔，sql文件包括扩展名且使用绝对路径，不使用<code>&gt;</code>指定输出文件时，将输出到命令行。选项有如下几类，可以在命令行或选项文件(如my.ini)的<code>[mysqldump]</code>和<code>[client]</code>组中指定，此处仅列出常用选项，除组合选项以外使用时不要求顺序，短选项方式区分大小写</p>
<p>连接选项：</p>
<ul>
<li><code>--host=主机名</code>或<code>-h 主机名</code>：指定主机名，默认为localhost</li>
<li><code>--port=端口号</code>或<code>-P 端口号</code>：使用TCP/IP连接时的端口号</li>
<li><code>--user=用户名</code>或<code>-u 用户名</code>：用于连接到MySQL服务器的用户名（不含主机名）</li>
<li><code>--password[=password]</code>或<code>-p[password]</code>：账户密码，可以不填写值，在命令执行后提示输入，如果指定，则与选项名之间不能存在空格</li>
</ul>
<p>DDL选项：</p>
<ul>
<li><code>--add-drop-database</code>：在创建数据库之前删除数据库。默认不使用</li>
<li><code>--add-drop-table</code>：在创建表之前删除表</li>
<li><code>--no-create-db</code>或<code>-n</code>：在使用第二或第三种语法时不创建数据库</li>
<li><code>--no-create-info</code>或<code>-t</code>：不创建表</li>
<li><code>--replace</code>：对于数据使用替换语句而不是插入语句</li>
</ul>
<p>调试选项：</p>
<ul>
<li><code>--comments</code>或<code>-i</code>：在备份文件中写入注释信息，如程序版本、服务器版本和主机名。默认开启</li>
<li><code>--skip-comments</code>：不写入注释信息</li>
<li><code>--allow-keywords</code>：允许关键字作为列名。即在列名前加上表名</li>
<li><code>--force</code>或<code>-f</code>：强制执行，忽略备份时产生的所有错误</li>
<li><code>--verbose</code>或<code>-v</code>：详细模式，输出备份时的更多信息</li>
</ul>
<p>格式化选项：</p>
<ul>
<li><code>--compact</code>：使输出紧凑化，该选项会同时关闭删除数据库、写入注释、在插入时关闭索引以及设置字符集功能选项</li>
<li><code>--complete-insert</code>或<code>-c</code>：在插入语句中使用完整的列名</li>
<li><code>--create-options</code>：在建表语句中包含所有表选项</li>
<li><code>--quote-names</code>或<code>-Q</code>：对标识符使用反引号，默认启用</li>
<li><code>--result-file=文件名</code>或<code>-r 文件名</code>：输出到指定的文件，忽略错误并覆盖旧内容。固定换行符为<code>\n</code></li>
<li><code>--xml</code>或<code>-X</code>：输出为XML格式的文件</li>
</ul>
<p>过滤选项：</p>
<ul>
<li><code>--all-databases</code>或<code>-A</code>：与第三种语法相同，备份所有数据库</li>
<li><code>--ignore-table=库名.表名</code>：忽略指定的表，必须同时指定数据库和表名。要忽略多个表，需要多次使用此选项</li>
<li><code>--no-data</code>或<code>-d</code>：仅备份表结构，不备份表数据</li>
<li><code>--databases</code>或<code>-B</code>：与第二种语法相同，备份多个数据库时后面的所有名称被视为数据库名；备份单个数据库时可省略此选项，此时如果使用多个名称则第一个视为数据库名，后面的被视为表名，并且输出中不含<code>CREATE DATABASE</code>和<code>USE</code>语句</li>
<li><code>--tables</code>：重写前一个选项，将后面的所有名称视为表名</li>
<li><code>--where='条件表达式'</code>或<code>-w '条件表达式'</code>：仅备份指定WHERE条件的数据，如果条件表达式包含空格或命令行专用的其他字符，则必须加引号</li>
</ul>
<p>事务性选项：</p>
<ul>
<li><code>--add-locks</code>：在表数据的周围使用<code>LOCK TABLES</code>和<code>UNLOCK TABLES</code>语句，可以在还原时更快的加载数据</li>
<li><code>--flush-privileges</code>：在备份文件备份完数据库之后添加权限刷新语句。备份系统数据库时应当使用此选项</li>
<li><code>--no-autocommit</code>：备份时将表数据的插入包括事务中（使用<code>SET autocommit=0</code>和<code>COMMIT</code>语句）</li>
<li><code>--order-by-primary</code>：在备份时按主键或第一个唯一索引列排序</li>
<li><code>--single-transaction</code>：将事务隔离模式设置为可重复读并使用事务模式备份数据</li>
</ul>
<p>性能选项：</p>
<ul>
<li><code>--extended-insert</code>或<code>-e</code>：使用一个插入语句插入多条数据（而不是每条一个）。可以减少备份文件的大小，并且在执行还原时速度更快</li>
<li><code>--insert-ignore</code>：使用<code>INSERT IGNORE</code>语句而不是<code>INSERT</code>语句</li>
<li><code>--quick</code>或<code>-q</code>：强制备份程序一次一行地检索表数据，而不是检索整个表，并且在写入文件前会先缓冲在内存中。对于备份大型表的数据很有用</li>
<li><code>--opt</code>：默认开启，此选项是这些选项的组合–add-drop-table --add-locks --create-options --extended-insert --quick --set-charset</li>
<li><code>--skip-opt</code>：关闭前一个选项</li>
</ul>
<blockquote>
<p>备份程序默认情况下忽略系统表INFORMATION_SCHEMA、performance_schema和sys。如果需要，请在选项中显式指定</p>
</blockquote>
<h3 id="恢复数据"><a class="markdownIt-Anchor" href="#恢复数据"></a> 恢复数据</h3>
<p>恢复数据，即重新加载mysqldump生成的文件。如果是通过<code>-all databases</code>或<code>--databases</code>选项生成的，恢复数据时就非常简单，同样在命令行执行</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql &lt; sql文件</span><br></pre></td></tr></table></figure>
<p>或者登录后使用</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source <span class="keyword">sql</span>文件</span><br></pre></td></tr></table></figure>
<p>sql文件同样需要包括扩展名且使用绝对路径。对于不包含<code>CREATE</code>和<code>USE</code>数据库语句的备份文件，在恢复时则需要先创建数据库并切换</p>

    </div>

    
    
    

    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>Vsouild
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="https://vsouild.github.io/mysql-extension/" title="MySQL扩展知识">https://vsouild.github.io/mysql-extension/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/tags/mysql/" rel="tag"><i class="fa fa-tag"></i> mysql</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/mysql-abc/" rel="prev" title="MySQL入门">
                  <i class="fa fa-chevron-left"></i> MySQL入门
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/java-mysql/" rel="next" title="Java与MySQL">
                  Java与MySQL <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    
  <div class="comments" id="disqus_thread">
    <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
  </div>
  
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-user-circle"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Vsouild</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="站点总字数">129k</span>
  </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/next-boot.js"></script>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.0/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>





  




  

  <script class="next-config" data-name="enableMath" type="application/json">false</script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.2/katex.min.css" integrity="sha256-oWCabCfPd4Oi21wqZezBSz/anto4VYcJqc9sM9IzQTk=" crossorigin="anonymous">


<script class="next-config" data-name="disqus" type="application/json">{"enable":true,"shortname":"vsouild.disqus.com","count":false,"i18n":{"disqus":"disqus"}}</script>
<script src="/js/third-party/comments/disqus.js"></script>

</body>
</html>
